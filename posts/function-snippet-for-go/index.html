<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#680"><title>Generate return values in Neovim for Go.</title><meta name="description" content="Generate return values in Neovim for Go."><link rel="stylesheet" href="/css/prism-base16-monokai.dark.css"><link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Kha&#39;s - Journeys and times of me"><link rel="alternate" href="/feed/feed.json" type="application/json" title="Kha&#39;s - Journeys and times of me"><link rel="stylesheet" href="/css/index.css"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({
        startOnLoad: true,
        theme: "forest",
      });</script></head><body><div class="topnav"><div class="topnav-content"><a href="/" style="vertical-align: middle"><img src="/img/home.svg" alt="home icon" align="middle" height="18" width="18"> <span>Kha</span> </a><a href="/research">Research</a> <a href="/blog">Blog</a><div class="topnav-right"><a href="https://github.com/lotusirous" target="_blank" rel="noreferrer" title="Github"><img alt="Github" src="/img/social/github.svg" height="20" width="20"></a><a href="https://twitter.com/__ngtrongkha" target="_blank" rel="noreferrer" title="Twitter"><img alt="Twitter" src="/img/social/twitter.svg" height="20" width="20"></a><a href="https://unix.stackexchange.com/users/40333/lotusirous" target="_blank" rel="noreferrer" title="StackExchange"><img alt="StackExchange" class="keep-original" src="/img/social/Stack_Exchange_icon.svg" height="20" width="20"></a></div></div></div><div id="content"><div id="main"><main><div class="article"><h1 class="post-title">Generate return values in Neovim for Go.</h1><div class="when"><time datetime="Saturday, May 28, 2022">Posted on Saturday, May 28, 2022</time></div><p>I'm a big fan of error handling in Go because of its clarity and simplicity. However, I sometimes find it tedious to have to type <code>if err != nil</code> for every error handling error. That's why I'm excited to share with you a new technique that I've discovered for reducing the number of keystrokes needed for error handling in Go. By combining the <a href="https://github.com/nvim-treesitter/nvim-treesitter">nvim-treesitter</a> and <a href="https://github.com/L3MON4D3/LuaSnip">LuaSnip</a> tools, you can easily generate the return values for your error handling errors, saving you time and making your code more efficient.</p><p>In this post, I'll explain how to set up and use this technique, so that you can enjoy the benefits of error handling in Go without all the tedious typing.</p><h2>Tree-sitter and LuaSnip</h2><p><strong>Tree-sitter</strong> is a parser generator tool that can build parsers for programming languages. It uses incremental parsing to quickly and accurately parse source code as it is being edited. In Go, tree-sitter can generate an abstract syntax tree (AST) for a Go source file, which can be used for code analysis, code completion, or code generation.</p><p><strong>LuaSnip</strong> is a neovim plugin that allows users to define and manage code snippets using Lua. It can save time and improve productivity by allowing users to insert code snippets quickly and easily. It also offers features like context-aware expansion, completion, and arguments.</p><h2>Generate the snippet</h2><p>This code defines a tree-sitter query for Go source code that uses the <code>set_query</code> function from the <code>vim.treesitter</code> module. The query is stored in a variable called <code>LuaSnip_Result</code>, and it searches for three different types of declarations in Go source code: method declarations, function declarations, and function literals.</p><p>For each of these declarations, the query stores the result in a variable called <code>@id</code>, which can be used later to reference the specific declaration that was found. The query uses the tree-sitter query language, which is a syntax for defining and running queries on abstract syntax trees (ASTs) generated by tree-sitter parsers.</p><p>The second part of the code creates a code snippet called &quot;iferr&quot; that uses the results of the <code>LuaSnip_Result</code> query to automatically generate the return values for the function or method specified in the &quot;f&quot; input field. This can save you time and effort. When you type &quot;iferr&quot; the result will match the function and returned value from the method.</p><pre class="language-lua"><code class="language-lua">vim<span class="token punctuation">.</span>treesitter<span class="token punctuation">.</span><span class="token function">set_query</span><span class="token punctuation">(</span><span class="token string">"go"</span><span class="token punctuation">,</span> <span class="token string">"LuaSnip_Result"</span><span class="token punctuation">,</span> <span class="token string">[[<br>    (method_declaration result: (_) @id)<br>    (function_declaration result: (_) @id)<br>    (func_literal result: (_) @id)<br>]]</span><span class="token punctuation">)</span><br><br><span class="token function">s</span><span class="token punctuation">(</span><span class="token string">"iferr"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    <span class="token function">i</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">"val"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    t <span class="token string">", "</span><span class="token punctuation">,</span><br>    <span class="token function">i</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">"err"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    t <span class="token string">" := "</span><span class="token punctuation">,</span><br>    <span class="token function">i</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">"f"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">t</span> <span class="token punctuation">{</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"if "</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token function">same</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">t</span> <span class="token punctuation">{</span> <span class="token string">" != nil {"</span><span class="token punctuation">,</span> <span class="token string">"\treturn "</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token function">d</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> go_ret_vals<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">t</span> <span class="token punctuation">{</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"}"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token function">i</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Let's give it a try.</p><pre><code>iferr&lt;c-k&gt;
</code></pre><h2>Conclusion</h2><p>In conclusion, this post has shown you how to use tree-sitter and LuaSnip to create a code snippet for Go development that can automatically generate the return values for error handling errors. This technique can improve your workflow and make your code more efficient and effective. By using this approach, you can reduce the amount of time and effort you spend on error handling in Go.</p><div class="direction"><div class="next">« <a href="/posts/golink/">Golink - URL shorten service</a></div><div class="previous"><a href="/posts/smart-contract-practices/">Smart contract hacking resources</a> »</div></div></div></main></div></div><footer></footer></body></html>