<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#680"><title>Generate return values in Neovim for Go.</title><meta name="description" content="Generate return values in Neovim for Go."><link rel="stylesheet" href="/css/prism-base16-monokai.dark.css"><link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Kha&#39;s - Journeys and times of me"><link rel="alternate" href="/feed/feed.json" type="application/json" title="Kha&#39;s - Journeys and times of me"><link rel="stylesheet" href="/css/index.css"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({
        startOnLoad: true,
        theme: "forest",
      });</script></head><body><div class="topnav"><div class="topnav-content"><a href="/" style="vertical-align: middle"><img src="/img/home.svg" alt="home icon" align="middle" height="18" width="18"> <span>Kha</span> </a><a href="/research">Research</a> <a href="/blog">Blog</a><div class="topnav-right"><a href="https://github.com/lotusirous" target="_blank" rel="noreferrer" title="Github"><img alt="Github" src="/img/social/github.svg" height="20" width="20"></a><a href="https://twitter.com/__ngtrongkha" target="_blank" rel="noreferrer" title="Twitter"><img alt="Twitter" src="/img/social/twitter.svg" height="20" width="20"></a><a href="https://unix.stackexchange.com/users/40333/lotusirous" target="_blank" rel="noreferrer" title="StackExchange"><img alt="StackExchange" class="keep-original" src="/img/social/Stack_Exchange_icon.svg" height="20" width="20"></a></div></div></div><div id="content"><div id="main"><main><div class="article"><h1 class="post-title">Generate return values in Neovim for Go.</h1><div class="when"><time datetime="Saturday, May 28, 2022">Posted on Saturday, May 28, 2022</time></div><p>I really love error handling in go because of clarity. However, typing <code>if err != nil</code> every error handling error is annoying. This post describes the step to combine the <a href="https://github.com/nvim-treesitter/nvim-treesitter">nvim-treesitter</a> and <a href="https://github.com/L3MON4D3/LuaSnip">LuaSnip</a> to generate the return values. It makes you type less keystrokes than before.</p><h2>Tree sitter</h2><p>Tree-sitter parses the go file and generate the AST</p><pre class="language-lua"><code class="language-lua">vim<span class="token punctuation">.</span>treesitter<span class="token punctuation">.</span><span class="token function">set_query</span><span class="token punctuation">(</span><br>    <span class="token string">"go"</span><span class="token punctuation">,</span><br>    <span class="token string">"LuaSnip_Result"</span><span class="token punctuation">,</span><br>    <span class="token string">[[ [<br>    (method_declaration result: (_) @id)<br>    (function_declaration result: (_) @id)<br>    (func_literal result: (_) @id)<br>  ] ]]</span><br><span class="token punctuation">)</span></code></pre><p>You query the method, function, name and saves to the variable <code>LuaSnip_Result</code></p><h2>Assign the snippet</h2><p>I honestly admit that the syntax for LuaSnip is quite ugly.</p><pre class="language-lua"><code class="language-lua">    <span class="token function">s</span><span class="token punctuation">(</span><span class="token string">"iferr"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>        <span class="token function">i</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">"val"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        t <span class="token string">", "</span><span class="token punctuation">,</span><br>        <span class="token function">i</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">"err"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        t <span class="token string">" := "</span><span class="token punctuation">,</span><br>        <span class="token function">i</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">"f"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token function">t</span> <span class="token punctuation">{</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"if "</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token function">same</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token function">t</span> <span class="token punctuation">{</span> <span class="token string">" != nil {"</span><span class="token punctuation">,</span> <span class="token string">"\treturn "</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token function">d</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> go_ret_vals<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token function">t</span> <span class="token punctuation">{</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"}"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token function">i</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>Give it a try</p><pre><code>iferr&lt;c-k&gt;
</code></pre><p>And BOOOMMMM !!</p><h2>Discussion</h2><p>This method reduces your typing keystrokes. However, the current method does not support the function that does not return any value. Neovim will raise an error for that.</p><div class="direction"><div class="next">« <a href="/posts/golink/">Golink - URL shorten service</a></div><div class="previous"><a href="/posts/smart-contract-practices/">Smart contract hacking resources</a> »</div></div></div></main></div></div><footer></footer></body></html>